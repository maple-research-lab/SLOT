[2025-04-23 15:21:37,293] [[32m    INFO[0m]: PyTorch version 2.5.1 available. (config.py:58)[0m
INFO 04-23 15:21:42 __init__.py:190] Automatically detected platform cuda.
[2025-04-23 15:21:43,464] [[32m    INFO[0m]: --- LOADING MODEL --- (pipeline.py:189)[0m
[2025-04-23 15:21:52,036] [[32m    INFO[0m]: This model supports multiple tasks: {'reward', 'embed', 'classify', 'score', 'generate'}. Defaulting to 'generate'. (config.py:542)[0m
[2025-04-23 15:21:52,038] [[32m    INFO[0m]: Initializing a V0 LLM engine (v0.7.2) with config: model='~/Models/Qwen/Qwen2.5-Math-1.5B', speculative_config=None, tokenizer='~/Models/Qwen/Qwen2.5-Math-1.5B', skip_tokenizer_init=False, tokenizer_mode=auto, revision=main, override_neuron_config=None, tokenizer_revision=main, trust_remote_code=False, dtype=torch.bfloat16, max_seq_len=4096, download_dir=None, load_format=LoadFormat.AUTO, tensor_parallel_size=1, pipeline_parallel_size=1, disable_custom_all_reduce=False, quantization=None, enforce_eager=False, kv_cache_dtype=auto,  device_config=cuda, decoding_config=DecodingConfig(guided_decoding_backend='xgrammar'), observability_config=ObservabilityConfig(otlp_traces_endpoint=None, collect_model_forward_time=False, collect_model_execute_time=False), seed=1234, served_model_name=~/Models/Qwen/Qwen2.5-Math-1.5B, num_scheduler_steps=1, multi_step_stream_outputs=True, enable_prefix_caching=False, chunked_prefill_enabled=False, use_async_output_proc=True, disable_mm_preprocessor_cache=False, mm_processor_kwargs=None, pooler_config=None, compilation_config={"splitting_ops":[],"compile_sizes":[],"cudagraph_capture_sizes":[128,120,112,104,96,88,80,72,64,56,48,40,32,24,16,8,4,2,1],"max_capture_size":128}, use_cached_outputs=False,  (llm_engine.py:234)[0m
[2025-04-23 15:21:53,054] [[32m    INFO[0m]: Using Flash Attention backend. (cuda.py:230)[0m
[2025-04-23 15:21:53,897] [[32m    INFO[0m]: Starting to load model ~/Models/Qwen/Qwen2.5-Math-1.5B... (model_runner.py:1110)[0m

Loading safetensors checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]

Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:01<00:00,  1.01s/it]

Loading safetensors checkpoint shards: 100% Completed | 1/1 [00:01<00:00,  1.01s/it]

[2025-04-23 15:21:55,827] [[32m    INFO[0m]: Loading model weights took 2.8797 GB (model_runner.py:1115)[0m
[2025-04-23 15:21:56,548] [[33m WARNING[0m]: ~/Projects/nips25_slot/open-r2/openr1/lib/python3.11/site-packages/vllm/worker/model_runner.py:1832: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  lm_head_weight = torch.load(lm_local, map_location=hidden_states_cur.device).to(dtype=torch.bfloat16)
 (warnings.py:110)[0m
[2025-04-23 15:21:56,963] [[32m    INFO[0m]: Memory profiling takes 0.95 seconds
the current vLLM instance can use total_gpu_memory (79.22GiB) x gpu_memory_utilization (0.90) = 71.29GiB
model weights take 2.88GiB; non_torch_memory takes 0.16GiB; PyTorch activation peak memory takes 6.30GiB; the rest of the memory reserved for KV Cache is 61.96GiB. (worker.py:267)[0m
[2025-04-23 15:21:57,134] [[32m    INFO[0m]: # CUDA blocks: 145022, # CPU blocks: 9362 (executor_base.py:110)[0m
[2025-04-23 15:21:57,135] [[32m    INFO[0m]: Maximum concurrency for 4096 tokens per request: 566.49x (executor_base.py:115)[0m
[2025-04-23 15:21:59,686] [[32m    INFO[0m]: Capturing cudagraphs for decoding. This may lead to unexpected consequences if the model is not static. To run the model in eager mode, set 'enforce_eager=True' or use '--enforce-eager' in the CLI. If out-of-memory error occurs during cudagraph capture, consider decreasing `gpu_memory_utilization` or switching to eager mode. You can also reduce the `max_num_seqs` as needed to decrease memory usage. (model_runner.py:1434)[0m
DEBUG - Starting CHOT optimization
DEBUG - CHOT parameters: steps=1, lr=0.1
DEBUG - hidden_states_orig: torch.Size([4096, 1536]), torch.bfloat16
Loading lm_local from: lm_head/Qwen2.5-Math-1.5B_lm_head.pt
cuda:0 torch.Size([151936, 1536])

Capturing CUDA graph shapes:   0%|          | 0/19 [00:00<?, ?it/s]
Capturing CUDA graph shapes:   5%|▌         | 1/19 [00:00<00:07,  2.54it/s]
Capturing CUDA graph shapes:  11%|█         | 2/19 [00:00<00:06,  2.68it/s]
Capturing CUDA graph shapes:  16%|█▌        | 3/19 [00:01<00:06,  2.61it/s]
Capturing CUDA graph shapes:  21%|██        | 4/19 [00:01<00:07,  1.93it/s]
Capturing CUDA graph shapes:  26%|██▋       | 5/19 [00:02<00:06,  2.09it/s]
Capturing CUDA graph shapes:  32%|███▏      | 6/19 [00:03<00:07,  1.72it/s]
Capturing CUDA graph shapes:  37%|███▋      | 7/19 [00:03<00:07,  1.70it/s]
Capturing CUDA graph shapes:  42%|████▏     | 8/19 [00:04<00:06,  1.78it/s]
Capturing CUDA graph shapes:  47%|████▋     | 9/19 [00:04<00:05,  2.00it/s]
Capturing CUDA graph shapes:  53%|█████▎    | 10/19 [00:04<00:04,  2.18it/s]
Capturing CUDA graph shapes:  58%|█████▊    | 11/19 [00:05<00:04,  1.73it/s]
Capturing CUDA graph shapes:  63%|██████▎   | 12/19 [00:06<00:03,  1.85it/s]
Capturing CUDA graph shapes:  68%|██████▊   | 13/19 [00:06<00:02,  2.06it/s]
Capturing CUDA graph shapes:  74%|███████▎  | 14/19 [00:06<00:02,  2.19it/s]
Capturing CUDA graph shapes:  79%|███████▉  | 15/19 [00:07<00:02,  1.98it/s]
Capturing CUDA graph shapes:  84%|████████▍ | 16/19 [00:07<00:01,  2.10it/s]
Capturing CUDA graph shapes:  89%|████████▉ | 17/19 [00:08<00:00,  2.22it/s]
Capturing CUDA graph shapes:  95%|█████████▍| 18/19 [00:08<00:00,  2.31it/s]
Capturing CUDA graph shapes: 100%|██████████| 19/19 [00:09<00:00,  2.10it/s]
Capturing CUDA graph shapes: 100%|██████████| 19/19 [00:09<00:00,  2.04it/s]
[2025-04-23 15:22:09,636] [[32m    INFO[0m]: Graph capturing finished in 10 secs, took 0.22 GiB (model_runner.py:1562)[0m
[2025-04-23 15:22:09,636] [[32m    INFO[0m]: init engine (profile, create kv cache, warmup model) took 13.81 seconds (llm_engine.py:431)[0m
[2025-04-23 15:22:11,059] [[32m    INFO[0m]: --- INIT SEEDS --- (pipeline.py:263)[0m
[2025-04-23 15:22:11,059] [[32m    INFO[0m]: --- LOADING TASKS --- (pipeline.py:216)[0m
[2025-04-23 15:22:11,059] [[32m    INFO[0m]: Found 1 custom tasks in ~/Projects/nips25_slot/open-r2/openr1/lib/python3.11/site-packages/lighteval/tasks/extended/ifeval/main.py (registry.py:142)[0m
[2025-04-23 15:22:11,060] [[32m    INFO[0m]: Found 6 custom tasks in ~/Projects/nips25_slot/open-r2/openr1/lib/python3.11/site-packages/lighteval/tasks/extended/tiny_benchmarks/main.py (registry.py:142)[0m
[2025-04-23 15:22:11,060] [[32m    INFO[0m]: Found 1 custom tasks in ~/Projects/nips25_slot/open-r2/openr1/lib/python3.11/site-packages/lighteval/tasks/extended/mt_bench/main.py (registry.py:142)[0m
[2025-04-23 15:22:11,060] [[32m    INFO[0m]: Found 4 custom tasks in ~/Projects/nips25_slot/open-r2/openr1/lib/python3.11/site-packages/lighteval/tasks/extended/mix_eval/main.py (registry.py:142)[0m
[2025-04-23 15:22:11,060] [[32m    INFO[0m]: Found 5 custom tasks in ~/Projects/nips25_slot/open-r2/openr1/lib/python3.11/site-packages/lighteval/tasks/extended/olympiade_bench/main.py (registry.py:142)[0m
[2025-04-23 15:22:11,060] [[32m    INFO[0m]: Found 1 custom tasks in ~/Projects/nips25_slot/open-r2/openr1/lib/python3.11/site-packages/lighteval/tasks/extended/hle/main.py (registry.py:142)[0m
[2025-04-23 15:22:11,060] [[32m    INFO[0m]: Found 21 custom tasks in ~/Projects/nips25_slot/open-r2/openr1/lib/python3.11/site-packages/lighteval/tasks/extended/lcb/main.py (registry.py:142)[0m
[2025-04-23 15:22:11,061] [[32m    INFO[0m]: HuggingFaceH4/aime_2024 default (lighteval_task.py:187)[0m
[2025-04-23 15:22:11,061] [[33m WARNING[0m]: Careful, the task lighteval|aime24 is using evaluation data to build the few shot examples. (lighteval_task.py:260)[0m
Using the latest cached version of the dataset since HuggingFaceH4/aime_2024 couldn't be found on the Hugging Face Hub
[2025-04-23 15:22:19,513] [[33m WARNING[0m]: Using the latest cached version of the dataset since HuggingFaceH4/aime_2024 couldn't be found on the Hugging Face Hub (load.py:1631)[0m
Found the latest cached dataset configuration 'default' at ~/.cache/huggingface/datasets/HuggingFaceH4___aime_2024/default/0.0.0/2fe88a2f1091d5048c0f36abc874fb997b3dd99a (last modified on Tue Apr  8 15:12:43 2025).
[2025-04-23 15:22:19,514] [[33m WARNING[0m]: Found the latest cached dataset configuration 'default' at ~/.cache/huggingface/datasets/HuggingFaceH4___aime_2024/default/0.0.0/2fe88a2f1091d5048c0f36abc874fb997b3dd99a (last modified on Tue Apr  8 15:12:43 2025). (cache.py:95)[0m
[2025-04-23 15:22:19,537] [[32m    INFO[0m]: --- RUNNING MODEL --- (pipeline.py:468)[0m
[2025-04-23 15:22:19,537] [[32m    INFO[0m]: Running RequestType.GREEDY_UNTIL requests (pipeline.py:472)[0m
[2025-04-23 15:22:19,544] [[33m WARNING[0m]: You cannot select the number of dataset splits for a generative evaluation at the moment. Automatically inferring. (data.py:260)[0m
HuggingFaceH4/aime_2024
default
False
None

Splits:   0%|          | 0/1 [00:00<?, ?it/s][2025-04-23 15:22:19,551] [[33m WARNING[0m]: context_size + max_new_tokens=4588 which is greater than self.max_length=4096. Truncating context to 0 tokens. (vllm_model.py:270)[0m


Processed prompts:   0%|          | 0/30 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s][A

Processed prompts:   3%|▎         | 1/30 [00:00<00:14,  2.05it/s, est. speed input: 312.93 toks/s, output: 26.59 toks/s][A

Processed prompts:   7%|▋         | 2/30 [00:02<00:37,  1.32s/it, est. speed input: 140.94 toks/s, output: 162.62 toks/s][A

Processed prompts:  10%|█         | 3/30 [00:02<00:26,  1.01it/s, est. speed input: 180.14 toks/s, output: 293.97 toks/s][A

Processed prompts:  13%|█▎        | 4/30 [00:03<00:24,  1.08it/s, est. speed input: 191.23 toks/s, output: 398.95 toks/s][A

Processed prompts:  20%|██        | 6/30 [00:03<00:11,  2.09it/s, est. speed input: 285.42 toks/s, output: 715.56 toks/s][A

Processed prompts:  23%|██▎       | 7/30 [00:04<00:08,  2.60it/s, est. speed input: 314.69 toks/s, output: 862.66 toks/s][A

Processed prompts:  27%|██▋       | 8/30 [00:04<00:06,  3.25it/s, est. speed input: 352.39 toks/s, output: 1010.81 toks/s][A

Processed prompts:  30%|███       | 9/30 [00:05<00:14,  1.46it/s, est. speed input: 279.62 toks/s, output: 907.13 toks/s] [A

Processed prompts:  33%|███▎      | 10/30 [00:05<00:10,  1.90it/s, est. speed input: 310.49 toks/s, output: 1064.26 toks/s][A

Processed prompts:  37%|███▋      | 11/30 [00:06<00:08,  2.23it/s, est. speed input: 320.88 toks/s, output: 1197.98 toks/s][A

Processed prompts:  40%|████      | 12/30 [00:06<00:07,  2.34it/s, est. speed input: 329.20 toks/s, output: 1309.27 toks/s][A

Processed prompts:  43%|████▎     | 13/30 [00:06<00:05,  2.89it/s, est. speed input: 346.68 toks/s, output: 1458.84 toks/s][A

Processed prompts:  50%|█████     | 15/30 [00:06<00:03,  4.25it/s, est. speed input: 385.43 toks/s, output: 1768.40 toks/s][A

Processed prompts:  53%|█████▎    | 16/30 [00:07<00:03,  3.58it/s, est. speed input: 387.74 toks/s, output: 1850.50 toks/s][A

Processed prompts:  57%|█████▋    | 17/30 [00:08<00:05,  2.40it/s, est. speed input: 379.04 toks/s, output: 1850.50 toks/s][A

Processed prompts:  60%|██████    | 18/30 [00:11<00:14,  1.20s/it, est. speed input: 290.69 toks/s, output: 1506.00 toks/s][A

Processed prompts:  63%|██████▎   | 19/30 [00:12<00:12,  1.10s/it, est. speed input: 293.08 toks/s, output: 1587.44 toks/s][A

Processed prompts:  67%|██████▋   | 20/30 [00:18<00:25,  2.60s/it, est. speed input: 206.47 toks/s, output: 1233.92 toks/s][A

Processed prompts:  70%|███████   | 21/30 [00:19<00:18,  2.10s/it, est. speed input: 222.41 toks/s, output: 1363.11 toks/s][A

Processed prompts:  73%|███████▎  | 22/30 [00:20<00:14,  1.80s/it, est. speed input: 224.95 toks/s, output: 1474.83 toks/s][A

Processed prompts:  77%|███████▋  | 23/30 [00:20<00:09,  1.33s/it, est. speed input: 234.69 toks/s, output: 1644.46 toks/s][A

Processed prompts:  80%|████████  | 24/30 [00:21<00:05,  1.01it/s, est. speed input: 242.78 toks/s, output: 1815.51 toks/s][A

Processed prompts:  90%|█████████ | 27/30 [00:21<00:01,  2.17it/s, est. speed input: 268.73 toks/s, output: 2356.90 toks/s][A

Processed prompts: 100%|██████████| 30/30 [00:21<00:00,  3.67it/s, est. speed input: 290.37 toks/s, output: 2899.10 toks/s][A
Processed prompts: 100%|██████████| 30/30 [00:21<00:00,  1.41it/s, est. speed input: 290.37 toks/s, output: 2899.10 toks/s]

Splits: 100%|██████████| 1/1 [00:21<00:00, 21.31s/it]
Splits: 100%|██████████| 1/1 [00:21<00:00, 21.31s/it]
[2025-04-23 15:22:41,469] [[32m    INFO[0m]: --- COMPUTING METRICS --- (pipeline.py:504)[0m
[2025-04-23 15:22:41,785] [[32m    INFO[0m]: --- DISPLAYING RESULTS --- (pipeline.py:546)[0m
[2025-04-23 15:22:41,794] [[32m    INFO[0m]: --- SAVING AND PUSHING RESULTS --- (pipeline.py:536)[0m
[2025-04-23 15:22:41,794] [[32m    INFO[0m]: Saving experiment tracker (evaluation_tracker.py:180)[0m
[2025-04-23 15:22:41,847] [[32m    INFO[0m]: Saving results to ~/Projects/nips25_slot/open-r2/data/evals~/Models/Qwen/Qwen2.5-Math-1.5B/results/_Models_Qwen_Qwen2.5-Math-1.5B/results_2025-04-23T15-22-41.794648.json (evaluation_tracker.py:234)[0m
DEBUG - Starting CHOT optimization
DEBUG - CHOT parameters: steps=1, lr=0.1
DEBUG - hidden_states_orig: torch.Size([4065, 1536]), torch.bfloat16
Loading lm_local from: lm_head/Qwen2.5-Math-1.5B_lm_head.pt
cuda:0 torch.Size([151936, 1536])
DEBUG - Starting CHOT optimization
DEBUG - CHOT parameters: steps=1, lr=0.1
DEBUG - hidden_states_orig: torch.Size([2117, 1536]), torch.bfloat16
Loading lm_local from: lm_head/Qwen2.5-Math-1.5B_lm_head.pt
cuda:0 torch.Size([151936, 1536])
|       Task       |Version|     Metric     |Value|   |Stderr|
|------------------|------:|----------------|----:|---|-----:|
|all               |       |extractive_match|  0.1|±  |0.0557|
|lighteval:aime24:0|      1|extractive_match|  0.1|±  |0.0557|

